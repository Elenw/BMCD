<!DOCTYPE html>
<html>
<head lang="cn">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE">
    <title>BMCD</title>
    <link href="/aui/css/aui-all.css" rel="stylesheet">
</head>
<body>
<div id="page">

    <header id="header" role="banner">
        <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
            <div class="aui-header-primary">
                <h1 id="logo" class="aui-header-logo"><a href="#"><span class="aui-header-logo-device">BMCD</span></a></h1>
                <ul class="aui-nav">
                    <li><a href="#dropdown2-jira3" aria-owns="dropdown2-jira3" aria-haspopup="true" class="aui-dropdown2-trigger" aria-controls="dropdown2-header7">服务器管理<span class="aui-icon-dropdown"></span></a>
                        <div class="aui-dropdown2 aui-style-default aui-dropdown2-in-header" id="dropdown2-jira3" style="display: none; top: 40px; min-width: 160px; left: 1213px; " aria-hidden="true">
                            <div class="aui-dropdown2-section">
                                <ul id="server-list">
                                    <li><button class="aui-button" onclick="window.location = '/admin/create.html'">创建</button></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li><a href="#dropdown2-jira2" aria-owns="dropdown2-jira2" aria-haspopup="true" class="aui-dropdown2-trigger" aria-controls="dropdown2-header7">BMCD管理<span class="aui-icon-dropdown"></span></a>
                        <div class="aui-dropdown2 aui-style-default aui-dropdown2-in-header" id="dropdown2-jira2" style="display: none; top: 40px; min-width: 160px; left: 1213px; " aria-hidden="true">
                            <div class="aui-dropdown2-section">
                                <ul id="">
                                    <li><a href="/admin/configure.html">参数设置</a></li>
                                    <li><a href="/admin/users.html">用户管理</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="aui-header-secondary">
                <ul class="aui-nav">
                    <li>
                    <li><a href="#dropdown2-header9" aria-owns="dropdown2-header9" aria-haspopup="true" class="aui-dropdown2-trigger" aria-controls="dropdown2-header9">
                        <div id="username">
                            <p></p>
                        </div>
                    </a>
                        <div class="aui-dropdown2 aui-style-default aui-dropdown2-in-header" id="dropdown2-header9" style="display: none; top: 40px; min-width: 160px; left: 1213px;" aria-hidden="true">
                            <div class="aui-dropdown2-section" id="adminMenu" style="display:hidden">
                                <ul>
                                    <li><a href="/admin/index.html">管理</a></li>
                                </ul>
                            </div>
                            <div class="aui-dropdown2-section">
                                <ul>
                                    <li><a href="#" id="logout">退出</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <section id="content">
        <header class="aui-page-header">
            <div class="aui-page-header-inner">
                <div class="aui-page-header-main">
                    <ol class="aui-nav aui-nav-breadcrumbs">
                        <li><a href="/">BMCD</a> </li>
                        <li><a href="/admin">后台</a> </li>
                        <li class="aui-nav-selected">编辑服务器 </li>
                    </ol>
                    <h1>BMCD服务器管理</h1>
                </div>
            </div>
        </header>
        <div class="aui-page-panel">
            <div class="aui-page-panel-inner">
                <section>
                    <form class="aui" id="editServer">
                        <div class="field-group">
                            <label for="serverName">服务器名称<span class="aui-icon icon-required">*</span></label><p id="serverName" class="medium-field"></p>
                        </div>
                        <div class="field-group">
                            <label for="host">服务器地址<span class="aui-icon icon-required">*</span></label><input id="host" type="text" required="required" class="text medium-field" placeholder="localhost"/>
                        </div>
                        <div class="field-group">
                            <label for="port">服务器端口<span class="aui-icon icon-required">*</span></label><input id="port" type="number" required="required" class="text medium-field" placeholder="25565"/>
                        </div>
                        <div class="field-group">
                            <label for="path">服务器路径<span class="aui-icon icon-required">*</span></label><input id="path" type="text" required="required" class="text medium-field"/>
                        </div>
                        <div class="field-group">
                            <label for="path">服务端文件名<span class="aui-icon icon-required">*</span></label><input id="file" type="text" required="required" class="text medium-field" placeholder="minecraft_server.jar"/>
                        </div>
                        <div class="button-container">
                            <div class="buttons">
                                <button class="aui-button aui-button-primary" type="submit">提交</button>
                                <button class="aui-button aui-button-link" type="reset">清空</button>
                            </div>
                        </div>
                    </form>
                </section>
                <table class="aui" id="server-status">
                    <tbody>
                    <tr>
                        <td class="server-status-key">
                            当前在线玩家
                        </td>
                        <td>
                            Loading
                        </td>
                    </tr>
                    <tr>
                        <td class="server-status-key">
                            服务器状态
                        </td>
                        <td>
                            <span class="aui-lozenge aui-lozenge-default">Loading</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="server-status-key">
                            操作
                        </td>
                        <td>
                            <button class="aui-button aui-button-primary" id="server-control-open" style="display:none">开启</button>
                            <button class="aui-button aui-button-primary" id="server-control-close" style="display:none">关闭</button>
                            <button class="aui-button aui-button-subtle" id="server-control-setting"><span class="aui-icon aui-icon-small aui-iconfont-configure">设置</span>设置</button>
                            <button class="aui-button aui-button-link" id="server-control-halt" style="display:none">强行关闭</button>
                        </td>
                    </tr>
                    <tr>
                        <td class="server-status-key">
                            管理
                        </td>
                        <td>
                            <p class="aui-buttons">
                                <button class="aui-button" id="server-manager-mod">mod</button>
                                <button class="aui-button" id="server-manager-plugin">插件</button>
                                <button class="aui-button" id="server-manager-save">存档</button>
                            </p>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p>服务器探测功能暂时只支持1.7以上版本的服务器</p>
            </div>
        </div>
    </section>

</div>
</body>
<script src="/aui/js/aui-all.js"></script>
<script src="//cdnjscn.b0.upaiyun.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="/javascripts/user.js"></script>
<script src="/javascripts/server.js"></script>
<script>
    $(document).ready(function (){
        $('#editServer').on('submit', function (){
            var that = $(this);
            var $serverName = $('#serverName');
            var $host = $('#host');
            var $port = $('#port');
            var $path = $('#path');
            var $file = $('#file');
            $.ajax('/admin/server/edit/' + $serverName.val() ,{
                data: {
                    serverName: $serverName.html(),
                    host: $host.val(),
                    port: $port.val(),
                    path: $path.val(),
                    file: $file.val()
                },
                method: 'post',
                statusCode: {
                    204: function (){
                        window.location.reload();
                    },
                    404: function (){
                        $path.after('<div class="error">路径不存在</div>');
                    }
                }
            });
            return false;
        });
        var serverName = window.location.hash.substr(1);
        if (!!serverName){
            $.get('/server/info/' + serverName, function (data){
                var $serverName = $('#serverName');
                var $host = $('#host');
                var $port = $('#port');
                var $path = $('#path');
                var $file = $('#file');
                $serverName.html(serverName);
                $host.val(data['host']);
                $port.val(data['port']);
                $path.val(data['path']);
                $file.val(data['file']);
                var $status = $('#server-status');
                $status.find('tr').eq(0).find('td').eq(1).text(data['playerCount'] + '/' + data['maxPlayers']);
                if (data['status'] == 'success'){
                    $status.find('tr').eq(1).find('td').eq(1).html('<span class="aui-lozenge aui-lozenge-success">正常 ' + data['version']['name'] + '</span>');
                    $('#server-control-close, #server-control-halt').show();
                } else if (data['status'] == 'failed'){
                    $status.find('tr').eq(1).find('td').eq(1).html('<span class="aui-lozenge aui-lozenge-error">关闭</span>');
                    $('#server-control-open').show();
                } else {
                    $status.find('tr').eq(1).find('td').eq(1).html('<span class="aui-lozenge aui-lozenge-error">超时</span>');
                    $('#server-control-close, #server-control-halt').show();
                    $('#server-control-open').show();
                }
            })
        }

    })
</script>
</html>